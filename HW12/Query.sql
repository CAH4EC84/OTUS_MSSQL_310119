USE WideWorldImporters
--1) Загрузить данные из файла StockItems.xml в таблицу StockItems. Существующие записи в таблице обновить, отсутствующие добавить (искать по StockItemName).

--Считываем данные как BLOB из XML - и записываеми их в переменную типа XML
DECLARE @xmlDocument AS XML
SET @xmlDocument = (
	SELECT * FROM OPENROWSET (
		BULK 'D:\Golikov_A_S\LearningMSSQL\11_examples-188-9df3d7\StockItems.xml',
		SINGLE_BLOB
	) as X
)

-- OpenXml преобразование XML в таблицу (т.к данных мало сохраним их во временную таблицу)
IF OBJECT_ID('tempdb..#TMPStockItems') IS NOT NULL DROP TABLE tempdb..#TMPStockItems

DECLARE @docHandle int
EXEC sp_xml_preparedocument @docHandle OUTPUT, @xmlDocument



Select * INTO #TMPStockItems
	FROM (SELECT * FROM OPENXML (@docHandle,'/StockItems/Item',3) /*1 - attributes 2 - elements 3 - both*/
	--Список разбираемых полей
	WITH (
		[Name] nvarchar(100),
		[SupplierID] int ,
		[UnitPackageID] int './Package/UnitPackageID' ,
		[OuterPackageID] int './Package/OuterPackageID',
		[QuantityPerOuter] int './Package/QuantityPerOuter',
		[TypicalWeightPerUnit] decimal(18,3) './Package/TypicalWeightPerUnit',
		[LeadTimeDays] int,
		[IsChillerStock] bit,
		[TaxRate] decimal(18,3),
		[UnitPrice] decimal(18,2)
	) ) as parsedXML
EXEC sp_xml_removedocument @docHandle

/*
Select tws.*
	from #TMPStockItems tws 
	left join [Warehouse].[StockItems] ws on tws.NAME = ws.[StockItemName]
where ws.[StockItemName] is null
*/

--Upsert через Megre
MERGE INTO [Warehouse].[StockItems] as TARGET
	USING #TMPStockItems as SOURCE
	ON SOURCE.NAME = TARGET.[StockItemName]
WHEN MATCHED THEN UPDATE
	SET TARGET.[SupplierID] = SOURCE.[SupplierID],
		TARGET.[UnitPackageID] = SOURCE.[UnitPackageID],
		TARGET.[OuterPackageID] = SOURCE.[OuterPackageID],
		TARGET.[QuantityPerOuter]  = SOURCE.[QuantityPerOuter] ,
		TARGET.[TypicalWeightPerUnit] = SOURCE.[TypicalWeightPerUnit],
		TARGET.[LeadTimeDays] = SOURCE.[LeadTimeDays],
		TARGET.[IsChillerStock]  = SOURCE.[IsChillerStock] ,
		TARGET.[TaxRate] = SOURCE.[TaxRate],
		TARGET.[UnitPrice] = SOURCE.[UnitPrice]
WHEN NOT MATCHED THEN INSERT (
	[StockItemName],[SupplierID],[UnitPackageID],[OuterPackageID],
	[QuantityPerOuter],[TypicalWeightPerUnit],[LeadTimeDays],
	[IsChillerStock],[TaxRate],[UnitPrice],
	--Ключи которых нет в XML
	[LastEditedBy]
)
VALUES (
	SOURCE.[NAME],SOURCE.[SupplierID],SOURCE.[UnitPackageID],
	SOURCE.[OuterPackageID],SOURCE.[QuantityPerOuter] ,SOURCE.[TypicalWeightPerUnit],
	SOURCE.[LeadTimeDays],SOURCE.[IsChillerStock] , SOURCE.[TaxRate],SOURCE.[UnitPrice],
	1
);




--2) Выгрузить данные из таблицы StockItems в такой же xml-файл, как StockItems.xml
Select top 3
	a.[StockItemName] as [@name],
	[SupplierID],
	(Select b.[UnitPackageID],b.[OuterPackageID],b.[QuantityPerOuter],b.[TypicalWeightPerUnit]
		from [Warehouse].[StockItems] b where a.[StockItemID] = b.[StockItemID]
		FOR XML PATH('Package'), TYPE
		),
	[LeadTimeDays],
	[IsChillerStock],
	[TaxRate],
	[UnitPrice]
from [Warehouse].[StockItems] a
Order by [@Name]
FOR XML PATH('Item'), ROOT('StockItems')

/*
3) В таблице StockItems в колонке CustomFields есть данные в json.
Написать select для вывода:
- StockItemID
- StockItemName
- CountryOfManufacture (из CustomFields)
- Range (из CustomFields)

*/
Select [StockItemID]
	,[StockItemName]
	,JSON_VALUE(CustomFields,'$.CountryOfManufacture') AS CountryOfManufacture
	,JSON_VALUE(CustomFields,'$.Range') AS Range
from [Warehouse].[StockItems] a

/*
4. Найти в StockItems строки, где есть тэг "Vintage"
Запрос написать через функции работы с JSON.
Тэги искать в поле CustomFields, а не в Tags.
*/
Select [StockItemID]
	,[StockItemName]
	,CustomFields
	,x.[value] as searchingInTagValue
from [Warehouse].[StockItems]
CROSS APPLY openjson ([Warehouse].[StockItems].CustomFields,'$.Tags') as x
where x.value = 'Vintage'


/*5. Пишем динамический PIVOT. 
По заданию из 8го занятия про CROSS APPLY и PIVOT 
Требуется написать запрос, который в результате своего выполнения формирует таблицу следующего вида:
Название клиента
МесяцГод Количество покупок

Нужно написать запрос, который будет генерировать результаты для всех клиентов 
имя клиента указывать полностью из CustomerName
дата должна иметь формат dd.mm.yyyy например 25.12.2019
*/


/*Формируем строку*/
DECLARE @firmsString as nvarchar(max) = '',
		@tmp as nvarchar(max);

DECLARE _cursor CURSOR FOR (Select DISTINCT CustomerName from Sales.Customers)
OPEN _cursor
FETCH NEXT FROM _cursor INTO @tmp;
WHILE @@FETCH_STATUS = 0  
BEGIN  
       Set @firmsString = @firmsString + '[' + ISNULL(@tmp,'') + '],'
   FETCH NEXT FROM _cursor into @tmp; 
END  
CLOSE _cursor;  
DEALLOCATE _cursor;
/*Встречаются строки с одиночной кавычкой [Wingtip Toys (Kapa'a, HI)]*/

--Set @firmsString = substring(REPLACE(@firmsString,char(39),char(39)+char(39)),1,LEN(@firmsString));
Select @firmsString
/*Формируем запрос*/


DECLARE @query as nvarchar(max);
Set @query ='Select FORMAT(PivotTable.InvDate, ''dd.MM.yyyy'' ),@firmsString FROM (Select DISTINCT  CAST (DATEADD(mm,DATEDIFF(mm,0,Inv.InvoiceDate),0) as DATE) as InvDate,	cros.substr,COUNT(*) OVER (Partition by Inv.CustomerID,FORMAT( CAST (DATEADD(mm,DATEDIFF(mm,0,Inv.InvoiceDate),0) as DATE), ''dd.MM.yyyy'' ) ) as InvDayCount from Sales.Invoices Inv 		CROSS APPLY (Select substring(CustomerName, CHARINDEX(''('',CustomerName)+1,CHARINDEX('')'',CustomerName) - CHARINDEX(''('',CustomerName)-1 ) as substr			FROM Sales.Customers c where c.CustomerID = Inv.CustomerID and [CustomerCategoryID] =3 and [BuyingGroupID] is not null) cros	) AS SourceTable PIVOT (	SUM (SourceTable.InvDayCount) 	FOR SourceTable.substr in( @firmsString) ) as PivotTable order by PivotTable.InvDate';
set @query = REPLACE(@query,char(39),char(39)+char(39))
Select @query


Exec sp_executesql @query,'@firmsString nvarchar(max)',@firmsString



Select FORMAT(PivotTable.InvDate, 'dd.MM.yyyy' ),
	[Tailspin Toys (Head Office)],[Tailspin Toys (Sylvanite, MT)],[Tailspin Toys (Peeples Valley, AZ)],[Tailspin Toys (Medicine Lodge, KS)],[Tailspin Toys (Gasport, NY)],[Tailspin Toys (Jessie, ND)],[Tailspin Toys (Frankewing, TN)],[Tailspin Toys (Bow Mar, CO)],[Tailspin Toys (Netcong, NJ)],[Tailspin Toys (Wimbledon, ND)],[Tailspin Toys (Devault, PA)],[Tailspin Toys (Biscay, MN)],[Tailspin Toys (Stonefort, IL)],[Tailspin Toys (Long Meadow, MD)],[Tailspin Toys (Batson, TX)],[Tailspin Toys (Coney Island, MO)],[Tailspin Toys (East Fultonham, OH)],[Tailspin Toys (Goffstown, NH)],[Tailspin Toys (Lemeta, AK)],[Tailspin Toys (College Place, WA)],[Tailspin Toys (Tresckow, PA)],[Tailspin Toys (Ward Ridge, FL)],[Tailspin Toys (Ikatan, AK)],[Tailspin Toys (Dundarrach, NC)],[Tailspin Toys (Avenal, CA)],[Tailspin Toys (Hedrick, IA)],[Tailspin Toys (Bowlus, MN)],[Tailspin Toys (North Ridge, NY)],[Tailspin Toys (Eulaton, AL)],[Tailspin Toys (Koontzville, WA)],[Tailspin Toys (Lake Stevens, WA)],[Tailspin Toys (Maypearl, TX)],[Tailspin Toys (Boyden Arbor, SC)],[Tailspin Toys (Dallardsville, TX)],[Tailspin Toys (Slanesville, WV)],[Tailspin Toys (Ekron, KY)],[Tailspin Toys (Kerby, OR)],[Tailspin Toys (Airport Drive, MO)],[Tailspin Toys (Diablock, KY)],[Tailspin Toys (Impact, TX)],[Tailspin Toys (Olivette, MO)],[Tailspin Toys (Arietta, NY)],[Tailspin Toys (Upper Preston, WA)],[Tailspin Toys (Amanda Park, WA)],[Tailspin Toys (Severna Park, MD)],[Tailspin Toys (Jemison, AL)],[Tailspin Toys (Lake Hughes, CA)],[Tailspin Toys (Trentwood, WA)],[Tailspin Toys (Muir, MI)],[Tailspin Toys (Hambleton, WV)],[Tailspin Toys (Imlaystown, NJ)],[Tailspin Toys (Idria, CA)],[Tailspin Toys (Nanafalia, AL)],[Tailspin Toys (Railroad, PA)],[Tailspin Toys (Gum Branch, GA)],[Tailspin Toys (Royal City, WA)],[Tailspin Toys (Lakemore, OH)],[Tailspin Toys (Mappsburg, VA)],[Tailspin Toys (Edgartown, MA)],[Tailspin Toys (East Dailey, WV)],[Tailspin Toys (Fairfield Glade, TN)],[Tailspin Toys (Great Neck Estates, NY)],[Tailspin Toys (Stallion Springs, CA)],[Tailspin Toys (Hodgdon, ME)],[Tailspin Toys (North Cowden, TX)],[Tailspin Toys (Madaket, MA)],[Tailspin Toys (Sentinel Butte, ND)],[Tailspin Toys (Gardere, LA)],[Tailspin Toys (Lytle Creek, CA)],[Tailspin Toys (New Baden, IL)],[Tailspin Toys (Good Hart, MI)],[Tailspin Toys (Cortaro, AZ)],[Tailspin Toys (Cokato, MN)],[Tailspin Toys (Indios, PR)],[Tailspin Toys (Windsor Locks, CT)],[Tailspin Toys (Yewed, OK)],[Tailspin Toys (Hahira, GA)],[Tailspin Toys (Sekiu, WA)],[Tailspin Toys (Page City, KS)],[Tailspin Toys (Valdese, NC)],[Tailspin Toys (Big Moose, NY)],[Tailspin Toys (La Cueva, NM)],[Tailspin Toys (Absecon, NJ)],[Tailspin Toys (Aceitunas, PR)],[Tailspin Toys (Andrix, CO)],[Tailspin Toys (New Lexington, OH)],[Tailspin Toys (Sauquoit, NY)],[Tailspin Toys (Dracut, MA)],[Tailspin Toys (Victory Gardens, NJ)],[Tailspin Toys (Tolna, ND)],[Tailspin Toys (Alstead, NH)],[Tailspin Toys (Sans Souci, SC)],[Tailspin Toys (Clewiston, FL)],[Tailspin Toys (Cheyenne Wells, CO)],[Tailspin Toys (Lavon, TX)],[Tailspin Toys (South La Paloma, TX)],[Tailspin Toys (Manchester Center, VT)],[Tailspin Toys (El Centro, CA)],[Tailspin Toys (Guin, AL)],[Tailspin Toys (Tunnelhill, PA)],[Tailspin Toys (Cundiyo, NM)],[Tailspin Toys (Fieldbrook, CA)],[Tailspin Toys (Kalvesta, KS)],[Tailspin Toys (Wallagrass, ME)],[Tailspin Toys (Tomnolen, MS)],[Tailspin Toys (Tumacacori, AZ)],[Tailspin Toys (Glen Avon, CA)],[Tailspin Toys (Bernie, MO)],[Tailspin Toys (South Laguna, CA)],[Tailspin Toys (North Crows Nest, IN)],[Tailspin Toys (Oriole Beach, FL)],[Tailspin Toys (Sallyards, KS)],[Tailspin Toys (Dahlia, NM)],[Tailspin Toys (Cherry Grove Beach, SC)],[Tailspin Toys (Bethania, NC)],[Tailspin Toys (Rafael Capó, PR)],[Tailspin Toys (Scofield, UT)],[Tailspin Toys (Vassalboro, ME)],[Tailspin Toys (Statenville, GA)],[Tailspin Toys (Bratenahl, OH)],[Tailspin Toys (Elrosa, MN)],[Tailspin Toys (McClave, CO)],[Tailspin Toys (Roe Park, NY)],[Tailspin Toys (Hanoverton, OH)],[Tailspin Toys (Annamoriah, WV)],[Tailspin Toys (Francis Mills, NJ)],[Tailspin Toys (Point Roberts, WA)],[Tailspin Toys (East Portal, CO)],[Tailspin Toys (Mineral Hills, MI)],[Tailspin Toys (Maple Shade, NJ)],[Tailspin Toys (Kwethluk, AK)],[Tailspin Toys (Minidoka, ID)],[Tailspin Toys (Lake Erie Beach, NY)],[Tailspin Toys (Tavares, FL)],[Tailspin Toys (Terre du Lac, MO)],[Tailspin Toys (Mount Montgomery, NV)],[Tailspin Toys (Carbonville, UT)],[Tailspin Toys (Navassa, NC)],[Tailspin Toys (Hardeeville, SC)],[Tailspin Toys (Furley, KS)],[Tailspin Toys (Arrow Rock, MO)],[Tailspin Toys (King Cove, AK)],[Tailspin Toys (Ashtabula, OH)],[Tailspin Toys (Larose, LA)],[Tailspin Toys (Manahawkin, NJ)],[Tailspin Toys (Belgreen, AL)],[Tailspin Toys (Fishtail, MT)],[Tailspin Toys (Baraboo, WI)],[Tailspin Toys (Inguadona, MN)],[Tailspin Toys (Corfu, NY)],[Tailspin Toys (Antares, AZ)],[Tailspin Toys (Sun River, MT)],[Tailspin Toys (Marcell, MN)],[Tailspin Toys (Eden Valley, MN)],[Tailspin Toys (Arbor Vitae, WI)],[Tailspin Toys (Hollywood Park, TX)],[Tailspin Toys (Saks, AL)],[Tailspin Toys (Donner, LA)],[Tailspin Toys (Saint Louis Park, MN)],[Tailspin Toys (Crary, ND)],[Tailspin Toys (Aspen Park, CO)],[Tailspin Toys (Glen Park, NY)],[Tailspin Toys (Panaca, NV)],[Tailspin Toys (Rothsville, PA)],[Tailspin Toys (Topstone, CT)],[Tailspin Toys (McCamey, TX)],[Tailspin Toys (Rockwall, TX)],[Tailspin Toys (Seagraves, TX)],[Tailspin Toys (Sinclair, WY)],[Tailspin Toys (Eastchester, NY)],[Tailspin Toys (Ortley Beach, NJ)],[Tailspin Toys (Madrone, NM)],[Tailspin Toys (Wappingers Falls, NY)],[Tailspin Toys (Astor Park, FL)],[Tailspin Toys (San Acacia, NM)],[Tailspin Toys (Malott, WA)],[Tailspin Toys (Orrtanna, PA)],[Tailspin Toys (Armstrong Creek, WI)],[Tailspin Toys (Hiteman, IA)],[Tailspin Toys (Caselton, NV)],[Tailspin Toys (Heilwood, PA)],[Tailspin Toys (Hayes Center, NE)],[Tailspin Toys (Tierra Verde, FL)],[Tailspin Toys (South Euclid, OH)],[Tailspin Toys (Vidrine, LA)],[Tailspin Toys (Placer, OR)],[Tailspin Toys (Brown City, MI)],[Tailspin Toys (Premont, TX)],[Tailspin Toys (Wilkes-Barre, PA)],[Tailspin Toys (Teutopolis, IL)],[Tailspin Toys (Orchard Hill, GA)],[Tailspin Toys (Optimo, NM)],[Tailspin Toys (Knifley, KY)],[Tailspin Toys (Naples Park, FL)],[Tailspin Toys (Lesslie, SC)],[Tailspin Toys (Howells, NE)],[Tailspin Toys (Magalia, CA)],[Tailspin Toys (Buell, MO)],[Tailspin Toys (Antonito, CO)],[Tailspin Toys (Tooele, UT)],[Tailspin Toys (Skyway, WA)],[Wingtip Toys (Head Office)],[Wingtip Toys (Black Lick, PA)],[Wingtip Toys (Queen Valley, AZ)],[Wingtip Toys (Penns Creek, PA)],[Wingtip Toys (Bourbonnais, IL)],[Wingtip Toys (Tuscaloosa, AL)],[Wingtip Toys (Mooringsport, LA)],[Wingtip Toys (Rockwall, TX)],[Wingtip Toys (Orick, CA)],[Wingtip Toys (Bernstein, TX)],[Wingtip Toys (Edmund, WI)],[Wingtip Toys (Bozeman Hot Springs, MT)],[Wingtip Toys (Truscott, TX)],[Wingtip Toys (Rose Tree, PA)],[Wingtip Toys (Leathersville, GA)],[Wingtip Toys (Necedah, WI)],[Wingtip Toys (Chetek, WI)],[Wingtip Toys (Yaak, MT)],[Wingtip Toys (Compass Lake, FL)],[Wingtip Toys (Herlong, CA)],[Wingtip Toys (Highland Home, AL)],[Wingtip Toys (Naches, WA)],[Wingtip Toys (Baldwin City, KS)],[Wingtip Toys (Heartwell, NE)],[Wingtip Toys (Bethel Acres, OK)],[Wingtip Toys (Willow Valley, AZ)],[Wingtip Toys (Athol Springs, NY)],[Wingtip Toys (Paw Paw Lake, MI)],[Wingtip Toys (Lilbourn, MO)],[Wingtip Toys (Lost River, ID)],[Wingtip Toys (Rosa Sánchez, PR)],[Wingtip Toys (Vamo, FL)],[Wingtip Toys (Balko, OK)],[Wingtip Toys (Lime Lake, NY)],[Wingtip Toys (Teutopolis, IL)],[Wingtip Toys (Gargatha, VA)],[Wingtip Toys (Cadogan, PA)],[Wingtip Toys (Lucasville, OH)],[Wingtip Toys (Cylon, WI)],[Wingtip Toys (Asher, OK)],[Wingtip Toys (Keosauqua, IA)],[Wingtip Toys (Homer City, PA)],[Wingtip Toys (Berville, MI)],[Wingtip Toys (Tea, SD)],[Wingtip Toys (Dacono, CO)],[Wingtip Toys (Saint Landry, LA)],[Wingtip Toys (Coin, IA)],[Wingtip Toys (Salt Wells, NV)],[Wingtip Toys (Delray, WV)],[Wingtip Toys (Mount Summit, IN)],[Wingtip Toys (Smoot, WY)],[Wingtip Toys (Lake Davis, CA)],[Wingtip Toys (Stanardsville, VA)],[Wingtip Toys (Corcovado, PR)],[Wingtip Toys (Taft Heights, CA)],[Wingtip Toys (West Hempstead, NY)],[Wingtip Toys (Portales, NM)],[Wingtip Toys (Coker, AL)],[Wingtip Toys (Haydenville, OH)],[Wingtip Toys (Mayhill, NM)],[Wingtip Toys (Vair, TX)],[Wingtip Toys (Crossroads, NM)],[Wingtip Toys (Cowlington, OK)],[Wingtip Toys (Glen Ullin, ND)],[Wingtip Toys (Oologah, OK)],[Wingtip Toys (Lytle, TX)],[Wingtip Toys (Mahaffey, PA)],[Wingtip Toys (Sunburg, MN)],[Wingtip Toys (Johnetta, KY)],[Wingtip Toys (Universal City, TX)],[Wingtip Toys (Ridgemark, CA)],[Wingtip Toys (San Jacinto, CA)],[Wingtip Toys (Floriston, CA)],[Wingtip Toys (Bokeelia, FL)],[Wingtip Toys (Cale, AR)],[Wingtip Toys (Karthaus, PA)],[Wingtip Toys (Glancy, MS)],[Wingtip Toys (Stoneboro, PA)],[Wingtip Toys (Mier, IN)],[Wingtip Toys (Wapinitia, OR)],[Wingtip Toys (White Church, MO)],[Wingtip Toys (Caton, NY)],[Wingtip Toys (Plum Branch, SC)],[Wingtip Toys (Mauldin, SC)],[Wingtip Toys (Bonner Springs, KS)],[Wingtip Toys (Lowellville, OH)],[Wingtip Toys (Elverson, PA)],[Wingtip Toys (Isabela, PR)],[Wingtip Toys (Sayner, WI)],[Wingtip Toys (Beals, ME)],[Wingtip Toys (Morton Grove, IL)],[Wingtip Toys (Birds, IL)],[Wingtip Toys (Federalsburg, MD)],[Wingtip Toys (Pikeview, CO)],[Wingtip Toys (Boalsburg, PA)],[Wingtip Toys (Port Hueneme, CA)],[Wingtip Toys (Verdery, SC)],[Wingtip Toys (Obetz, OH)],[Wingtip Toys (East Fultonham, OH)],[Wingtip Toys (Obion, TN)],[Wingtip Toys (Cavendish, VT)],[Wingtip Toys (Miesville, MN)],[Wingtip Toys (Valhalla, NC)],[Wingtip Toys (Cape Neddick, ME)],[Wingtip Toys (Silver Plume, CO)],[Wingtip Toys (North Beach Haven, NJ)],[Wingtip Toys (Downingtown, PA)],[Wingtip Toys (Branson West, MO)],[Wingtip Toys (Bergen Park, CO)],[Wingtip Toys (Grabill, IN)],[Wingtip Toys (North Manitou, MI)],[Wingtip Toys (Philip, SD)],[Wingtip Toys (Straughn, IN)],[Wingtip Toys (Gilford, NH)],[Wingtip Toys (Del Valle, TX)],[Wingtip Toys (Harkers Island, NC)],[Wingtip Toys (Licking, MO)],[Wingtip Toys (Raton, NM)],[Wingtip Toys (Boynton, OK)],[Wingtip Toys (Frenchburg, KY)],[Wingtip Toys (Robertsdale, AL)],[Wingtip Toys (Dickerson, MD)],[Wingtip Toys (Bruceton Mills, WV)],[Wingtip Toys (Cloquet, MN)],[Wingtip Toys (Claycomo, MO)],[Wingtip Toys (Beekmantown, NY)],[Wingtip Toys (Islip Terrace, NY)],[Wingtip Toys (Rich Creek, VA)],[Wingtip Toys (Griswoldville, GA)],[Wingtip Toys (East Mountain, TX)],[Wingtip Toys (Omer, MI)],[Wingtip Toys (Waycross, GA)],[Wingtip Toys (Nichols Hills, OK)],[Wingtip Toys (Plaquemine, LA)],[Wingtip Toys (Triadelphia, WV)],[Wingtip Toys (Ferney, SD)],[Wingtip Toys (Akhiok, AK)],[Wingtip Toys (Deeson, MS)],[Wingtip Toys (Nuangola, PA)],[Wingtip Toys (Weld, ME)],[Wingtip Toys (Mickleton, NJ)],[Wingtip Toys (Schererville, IN)],[Wingtip Toys (Lexington Heights, MI)],[Wingtip Toys (Broomtown, AL)],[Wingtip Toys (Jamison, IA)],[Wingtip Toys (Key Biscayne, FL)],[Wingtip Toys (Chaseley, ND)],[Wingtip Toys (Indian Creek, IL)],[Wingtip Toys (Lake Ronkonkoma, NY)],[Wingtip Toys (Morrison Bluff, AR)],[Wingtip Toys (Huntingburg, IN)],[Wingtip Toys (Shay, PA)],[Wingtip Toys (Helotes, TX)],[Wingtip Toys (Hollandsburg, IN)],[Wingtip Toys (Liberty Grove, MD)],[Wingtip Toys (Morita, TX)],[Wingtip Toys (New Laguna, NM)],[Wingtip Toys (Bourneville, OH)],[Wingtip Toys (Mendoza, TX)],[Wingtip Toys (Palmas del Mar, PR)],[Wingtip Toys (Marion Junction, AL)],[Wingtip Toys (Ware Shoals, SC)],[Wingtip Toys (Lostine, OR)],[Wingtip Toys (Tilleda, WI)],[Wingtip Toys (Wapiti, WY)],[Wingtip Toys (Amado, AZ)],[Wingtip Toys (Jeromesville, OH)],[Wingtip Toys (Ovilla, TX)],[Wingtip Toys (West Frostproof, FL)],[Wingtip Toys (Flomaton, AL)],[Wingtip Toys (Pawlet, VT)],[Wingtip Toys (Trout Run, PA)],[Wingtip Toys (Marin City, CA)],[Wingtip Toys (Molalla, OR)],[Wingtip Toys (Trumansburg, NY)],[Wingtip Toys (Goodings Grove, IL)],[Wingtip Toys (Cherryplain, NY)],[Wingtip Toys (Bell Acres, PA)],[Wingtip Toys (Connoquenessing, PA)],[Wingtip Toys (Sarversville, PA)],[Wingtip Toys (Munich, ND)],[Wingtip Toys (Montoya, NM)],[Wingtip Toys (Knights Landing, CA)],[Wingtip Toys (Cache, OK)],[Wingtip Toys (Towaco, NJ)],[Wingtip Toys (Lynne, FL)],[Wingtip Toys (Plata, TX)],[Wingtip Toys (Oak Point, TX)],[Wingtip Toys (Alcester, SD)],[Wingtip Toys (McAdenville, NC)],[Wingtip Toys (Idaho City, ID)],[Wingtip Toys (Dunkerton, IA)],[Wingtip Toys (Cuyamungue, NM)],[Wingtip Toys (Marfa, TX)],[Wingtip Toys (Accomac, VA)],[Wingtip Toys (Cos Cob, CT)],[Wingtip Toys (Haycock, AK)],[Wingtip Toys (Kapa'a, HI)],[Wingtip Toys (Dickworsham, TX)],[Wingtip Toys (Caro, MI)],[Wingtip Toys (Ruthsburg, MD)],[Eric Torres],[Cosmina Vlad],[Bala Dixit],[Aleksandrs Riekstins],[Ratan Poddar],[Shi Tu],[Gunnar Lohmus],[Jackson Kolios],[Madhu Dwivedi],[Alena Kellnerova],[Surendra Sahu],[Celica Barajas],[Shyam Poddar],[Johanna Hoornstra],[Libuse Valentova],[Harsha Huq],[Agrita Kanepa],[Liia Orav],[Santiago Vera],[Knut Svensson],[Kwanjai Saowaluk],[Suparna Bhattacharya],[Francisca Laureano],[Risto Valbe],[Jayanta Thakur],[Leila Carvalho],[Crina Grasu],[Sercan Celik],[Jack Walker],[Jana Fialova],[Bhaavan Rai],[Aakriti Byrraju],[Devraj Rao],[Cong Hoa],[Dominic Davignon],[Abel Spirlea],[Anil Sarkar],[Pavel Bogdanov],[Juan Morse],[Rodrigo Figueiredo],[Camille Authier],[Biju Deb],[Marija Justina Pasek],[Durdanah Abbasi],[Emilie Hrdlickova],[Malorie Bousquet],[Kristiina Ivanov],[Alvin Bollinger],[Sabine Zalite],[Daakshaayaani Sankaramanchi],[Ebru Erdogan],[Bhagavaan Atluri],[Caterina Pinto],[Daakshaayaani Kommineni],[Anna Mazzanti],[Satish Mittal],[Clarissa Manfrin],[Bimla PrabhupÄda],[Shah Alizadeh],[Marcela Lucescu],[Amarasimha Vinjamuri],[Lana Goransson],[Jakub Lukes],[Mikhail Degtyarev],[Bijoya Thakur],[Jay Bhuiyan],[Jasna Cerkez],[Laura Sykorova],[Abel Tatarescu],[In-Su Bae],[Darshana Madhunapantula],[Katerina Hadrabova],[Hana Hlouskova],[Daniel Martensson],[Philip Walker],[Marie LeBatelier],[Leyla Siavashi],[Miriam House],[Jitka Necesana],[Edmee Glissen],[Magdalena Michnova],[Maryann Huddleston],[Radha Barua],[Anindya Ghatak],[Chandrashekhar Dasgupta],[Debbie Molina],[Baran Jonsson],[Jai Lamble],[Sointu Savonheimo],[Olya Izmaylov],[Taneli Riutta],[Bahaar Asef zade],[Leyla Asef zade],[Gabriela Hernandes],[Geza Roman],[Leonardo Folliero],[Allan Mannik],[Gopalgobinda Sikdar],[Chin-Sun Chang],[Lilli Sokk],[Adrian Andreasson],[Kamila Michnova],[Bing Han],[Olafs Rozitis],[Sara Huiting],[Ajitaab Pakalapati],[Eugen Agafitei],[Sumati Bhat],[Dena Glissen],[Elina Kaleja],[Liidia Lepp],[Volkan senturk],[Violetta KlanCisar],[Chandana Shasthri],[Ana Florea],[Pinja Jantunen],[Pari Hosseini],[Isidora Morales],[Kertu Sokk],[Gayatri Gajula],[Victoria Lacusta],[Sumati Chatterjee],[Tai Bach],[Eva Schulteisz],[Can ozcan],[Richard Friar],[Matyas Sedlar],[Arijit Bhuiyan],[Vladimir Henzl],[Shantanu Huq],[Nada Jovanovic],[Nicolo Cattaneo],[Joel Carrillo],[Ivan Sepulveda],[Daevasree Samavedam],[Ludmila Smidova],[Manca Hrastovsek],[Anna Gyarmathi],[Ioana Florea],[Lorin Astrom],[Bishwa Chatterjee],[Chaayaadaevi Sonti],[Drazenka Jelic],[Ida Celma],[Hoc Tran],[David safranek],[Svetlana Todorovic],[Richard Zahradnicek],[Seo-yun Paik],[Emily Whittle],[Eliza Persson],[Chuan Wattanasin],[Linh Dao],[Nasrin Omidzadeh],[Raghu Sandhu],[Nhung Thach],[Hee-Young Suh],[Valentin Tirlea],[Dhaatri Chavva],[Edgar Jogi],[Rani Ganguly],[Bhagavati Vinjamuri],[Be Trang],[Ingrida Zeltina],[Phoung Cu],[Sara Walkky],[Meera Patel],[Anca Gogean],[Staffan Persson],[Isidora Urias],[Dhanishta Mokkapati],[Lakshmi Benipal],[Kumar Kamei],[Emil Roman],[Prabodh Nair],[Alinne Matos],[Mauno Laurila],[Baalaamjali Devulapalli],[Melani Ravlen],[Om Yadav],[Mahmut ozbek],[Yves Belisle],[Sabine Alksne],[Kamala Nishad],[Roko Ilic],[Neil Farrelly],[Akhil Nadar],[Maksims Krastins],[Milinka Zujovic],[Andris Saulitis],[Valter Viiding],[Amarakumaar Gadiyaram],[Gasper Havzija],[Libuse Kuchtova],[Kumar Naicker],[Laszlo Gardenier],[Nada Ana Slosar],[Mahavir Sonkar],[Kristi Part],[Krishnam Allu],[Dinh Mai],[Stefan Selezeanu],[Hue Ton],[Drishti Bose],[Bhadram Kamasamudram],[Taj Syme],[Irma Berzina],[Vedrana Kovacevic],[Bhagavateeprasaad Malladi],[Serdar ozCelik],[Rajeev Sandhu],[Urve Kasesalu],[Annette  Hetu],[Narendra Tickoo],[Isa Hulsegge],[Aive Petrov],[David Novacek ],[Nils Kaulins],[Dhanishta Pullela],[Hai Banh],[Fabrice Cloutier],[Nadir Seddigh],[Farzana Habibi],[Arka Chatterjee],[Tuulikki Linna],[Daniella Cavalcante],[Serdar ozden],[Emma Van Zant],[Veronika Necesana],[Chompoo Atitarn],[Dipti Shah],[Som Mukherjee],[Cuneyt Arslan],[Aishwarya Dantuluri],[Manjunatha Karnik],[Erik Malk],[David Jaramillo],[Damodara Trivedi],[Bhaamini Palagummi],[Damodar Shenoy],[Tomo Vidovic],[Nguyen Banh],[Raj Verma],[Hanita Nookala],[Matteo Cattaneo],[Christian Couet],[Ivana Hadrabova],[Abhra Ganguly],[Amet Shergill],[Amrita Ganguly],[Sylvie Laramee],[Ian Olofsson],[Luis Saucedo],[Emma Salpa],[Adriana Pena],[Kalyani Benjaree],[Ganesh Majumdar],[Jaroslav Fisar],[Jibek Juniskyzy],[Anand Mudaliyar],[Agrita Abele],[Aleksey - Updated],[Andrey - Updated],[Anton MERGE],[Argronom MERGE],[Aleksey - UpdatedNEW RECORD],[Andrey - UpdatedNEW RECORD]
FROM 
	(Select DISTINCT  
	CAST (DATEADD(mm,DATEDIFF(mm,0,Inv.InvoiceDate),0) as DATE) as InvDate, 
	cros.substr,
	COUNT(*) OVER (Partition by Inv.CustomerID,FORMAT( CAST (DATEADD(mm,DATEDIFF(mm,0,Inv.InvoiceDate),0) as DATE), 'dd.MM.yyyy' ) ) as InvDayCount 
	from Sales.Invoices Inv   
	CROSS APPLY (Select CustomerName as substr   
		FROM Sales.Customers c 
	Where c.CustomerID = Inv.CustomerID ) 
	cros ) 
AS SourceTable 
PIVOT ( SUM (SourceTable.InvDayCount)  
FOR SourceTable.substr in(
	[Tailspin Toys (Head Office)],[Tailspin Toys (Sylvanite, MT)],[Tailspin Toys (Peeples Valley, AZ)],[Tailspin Toys (Medicine Lodge, KS)],[Tailspin Toys (Gasport, NY)],[Tailspin Toys (Jessie, ND)],[Tailspin Toys (Frankewing, TN)],[Tailspin Toys (Bow Mar, CO)],[Tailspin Toys (Netcong, NJ)],[Tailspin Toys (Wimbledon, ND)],[Tailspin Toys (Devault, PA)],[Tailspin Toys (Biscay, MN)],[Tailspin Toys (Stonefort, IL)],[Tailspin Toys (Long Meadow, MD)],[Tailspin Toys (Batson, TX)],[Tailspin Toys (Coney Island, MO)],[Tailspin Toys (East Fultonham, OH)],[Tailspin Toys (Goffstown, NH)],[Tailspin Toys (Lemeta, AK)],[Tailspin Toys (College Place, WA)],[Tailspin Toys (Tresckow, PA)],[Tailspin Toys (Ward Ridge, FL)],[Tailspin Toys (Ikatan, AK)],[Tailspin Toys (Dundarrach, NC)],[Tailspin Toys (Avenal, CA)],[Tailspin Toys (Hedrick, IA)],[Tailspin Toys (Bowlus, MN)],[Tailspin Toys (North Ridge, NY)],[Tailspin Toys (Eulaton, AL)],[Tailspin Toys (Koontzville, WA)],[Tailspin Toys (Lake Stevens, WA)],[Tailspin Toys (Maypearl, TX)],[Tailspin Toys (Boyden Arbor, SC)],[Tailspin Toys (Dallardsville, TX)],[Tailspin Toys (Slanesville, WV)],[Tailspin Toys (Ekron, KY)],[Tailspin Toys (Kerby, OR)],[Tailspin Toys (Airport Drive, MO)],[Tailspin Toys (Diablock, KY)],[Tailspin Toys (Impact, TX)],[Tailspin Toys (Olivette, MO)],[Tailspin Toys (Arietta, NY)],[Tailspin Toys (Upper Preston, WA)],[Tailspin Toys (Amanda Park, WA)],[Tailspin Toys (Severna Park, MD)],[Tailspin Toys (Jemison, AL)],[Tailspin Toys (Lake Hughes, CA)],[Tailspin Toys (Trentwood, WA)],[Tailspin Toys (Muir, MI)],[Tailspin Toys (Hambleton, WV)],[Tailspin Toys (Imlaystown, NJ)],[Tailspin Toys (Idria, CA)],[Tailspin Toys (Nanafalia, AL)],[Tailspin Toys (Railroad, PA)],[Tailspin Toys (Gum Branch, GA)],[Tailspin Toys (Royal City, WA)],[Tailspin Toys (Lakemore, OH)],[Tailspin Toys (Mappsburg, VA)],[Tailspin Toys (Edgartown, MA)],[Tailspin Toys (East Dailey, WV)],[Tailspin Toys (Fairfield Glade, TN)],[Tailspin Toys (Great Neck Estates, NY)],[Tailspin Toys (Stallion Springs, CA)],[Tailspin Toys (Hodgdon, ME)],[Tailspin Toys (North Cowden, TX)],[Tailspin Toys (Madaket, MA)],[Tailspin Toys (Sentinel Butte, ND)],[Tailspin Toys (Gardere, LA)],[Tailspin Toys (Lytle Creek, CA)],[Tailspin Toys (New Baden, IL)],[Tailspin Toys (Good Hart, MI)],[Tailspin Toys (Cortaro, AZ)],[Tailspin Toys (Cokato, MN)],[Tailspin Toys (Indios, PR)],[Tailspin Toys (Windsor Locks, CT)],[Tailspin Toys (Yewed, OK)],[Tailspin Toys (Hahira, GA)],[Tailspin Toys (Sekiu, WA)],[Tailspin Toys (Page City, KS)],[Tailspin Toys (Valdese, NC)],[Tailspin Toys (Big Moose, NY)],[Tailspin Toys (La Cueva, NM)],[Tailspin Toys (Absecon, NJ)],[Tailspin Toys (Aceitunas, PR)],[Tailspin Toys (Andrix, CO)],[Tailspin Toys (New Lexington, OH)],[Tailspin Toys (Sauquoit, NY)],[Tailspin Toys (Dracut, MA)],[Tailspin Toys (Victory Gardens, NJ)],[Tailspin Toys (Tolna, ND)],[Tailspin Toys (Alstead, NH)],[Tailspin Toys (Sans Souci, SC)],[Tailspin Toys (Clewiston, FL)],[Tailspin Toys (Cheyenne Wells, CO)],[Tailspin Toys (Lavon, TX)],[Tailspin Toys (South La Paloma, TX)],[Tailspin Toys (Manchester Center, VT)],[Tailspin Toys (El Centro, CA)],[Tailspin Toys (Guin, AL)],[Tailspin Toys (Tunnelhill, PA)],[Tailspin Toys (Cundiyo, NM)],[Tailspin Toys (Fieldbrook, CA)],[Tailspin Toys (Kalvesta, KS)],[Tailspin Toys (Wallagrass, ME)],[Tailspin Toys (Tomnolen, MS)],[Tailspin Toys (Tumacacori, AZ)],[Tailspin Toys (Glen Avon, CA)],[Tailspin Toys (Bernie, MO)],[Tailspin Toys (South Laguna, CA)],[Tailspin Toys (North Crows Nest, IN)],[Tailspin Toys (Oriole Beach, FL)],[Tailspin Toys (Sallyards, KS)],[Tailspin Toys (Dahlia, NM)],[Tailspin Toys (Cherry Grove Beach, SC)],[Tailspin Toys (Bethania, NC)],[Tailspin Toys (Rafael Capó, PR)],[Tailspin Toys (Scofield, UT)],[Tailspin Toys (Vassalboro, ME)],[Tailspin Toys (Statenville, GA)],[Tailspin Toys (Bratenahl, OH)],[Tailspin Toys (Elrosa, MN)],[Tailspin Toys (McClave, CO)],[Tailspin Toys (Roe Park, NY)],[Tailspin Toys (Hanoverton, OH)],[Tailspin Toys (Annamoriah, WV)],[Tailspin Toys (Francis Mills, NJ)],[Tailspin Toys (Point Roberts, WA)],[Tailspin Toys (East Portal, CO)],[Tailspin Toys (Mineral Hills, MI)],[Tailspin Toys (Maple Shade, NJ)],[Tailspin Toys (Kwethluk, AK)],[Tailspin Toys (Minidoka, ID)],[Tailspin Toys (Lake Erie Beach, NY)],[Tailspin Toys (Tavares, FL)],[Tailspin Toys (Terre du Lac, MO)],[Tailspin Toys (Mount Montgomery, NV)],[Tailspin Toys (Carbonville, UT)],[Tailspin Toys (Navassa, NC)],[Tailspin Toys (Hardeeville, SC)],[Tailspin Toys (Furley, KS)],[Tailspin Toys (Arrow Rock, MO)],[Tailspin Toys (King Cove, AK)],[Tailspin Toys (Ashtabula, OH)],[Tailspin Toys (Larose, LA)],[Tailspin Toys (Manahawkin, NJ)],[Tailspin Toys (Belgreen, AL)],[Tailspin Toys (Fishtail, MT)],[Tailspin Toys (Baraboo, WI)],[Tailspin Toys (Inguadona, MN)],[Tailspin Toys (Corfu, NY)],[Tailspin Toys (Antares, AZ)],[Tailspin Toys (Sun River, MT)],[Tailspin Toys (Marcell, MN)],[Tailspin Toys (Eden Valley, MN)],[Tailspin Toys (Arbor Vitae, WI)],[Tailspin Toys (Hollywood Park, TX)],[Tailspin Toys (Saks, AL)],[Tailspin Toys (Donner, LA)],[Tailspin Toys (Saint Louis Park, MN)],[Tailspin Toys (Crary, ND)],[Tailspin Toys (Aspen Park, CO)],[Tailspin Toys (Glen Park, NY)],[Tailspin Toys (Panaca, NV)],[Tailspin Toys (Rothsville, PA)],[Tailspin Toys (Topstone, CT)],[Tailspin Toys (McCamey, TX)],[Tailspin Toys (Rockwall, TX)],[Tailspin Toys (Seagraves, TX)],[Tailspin Toys (Sinclair, WY)],[Tailspin Toys (Eastchester, NY)],[Tailspin Toys (Ortley Beach, NJ)],[Tailspin Toys (Madrone, NM)],[Tailspin Toys (Wappingers Falls, NY)],[Tailspin Toys (Astor Park, FL)],[Tailspin Toys (San Acacia, NM)],[Tailspin Toys (Malott, WA)],[Tailspin Toys (Orrtanna, PA)],[Tailspin Toys (Armstrong Creek, WI)],[Tailspin Toys (Hiteman, IA)],[Tailspin Toys (Caselton, NV)],[Tailspin Toys (Heilwood, PA)],[Tailspin Toys (Hayes Center, NE)],[Tailspin Toys (Tierra Verde, FL)],[Tailspin Toys (South Euclid, OH)],[Tailspin Toys (Vidrine, LA)],[Tailspin Toys (Placer, OR)],[Tailspin Toys (Brown City, MI)],[Tailspin Toys (Premont, TX)],[Tailspin Toys (Wilkes-Barre, PA)],[Tailspin Toys (Teutopolis, IL)],[Tailspin Toys (Orchard Hill, GA)],[Tailspin Toys (Optimo, NM)],[Tailspin Toys (Knifley, KY)],[Tailspin Toys (Naples Park, FL)],[Tailspin Toys (Lesslie, SC)],[Tailspin Toys (Howells, NE)],[Tailspin Toys (Magalia, CA)],[Tailspin Toys (Buell, MO)],[Tailspin Toys (Antonito, CO)],[Tailspin Toys (Tooele, UT)],[Tailspin Toys (Skyway, WA)],[Wingtip Toys (Head Office)],[Wingtip Toys (Black Lick, PA)],[Wingtip Toys (Queen Valley, AZ)],[Wingtip Toys (Penns Creek, PA)],[Wingtip Toys (Bourbonnais, IL)],[Wingtip Toys (Tuscaloosa, AL)],[Wingtip Toys (Mooringsport, LA)],[Wingtip Toys (Rockwall, TX)],[Wingtip Toys (Orick, CA)],[Wingtip Toys (Bernstein, TX)],[Wingtip Toys (Edmund, WI)],[Wingtip Toys (Bozeman Hot Springs, MT)],[Wingtip Toys (Truscott, TX)],[Wingtip Toys (Rose Tree, PA)],[Wingtip Toys (Leathersville, GA)],[Wingtip Toys (Necedah, WI)],[Wingtip Toys (Chetek, WI)],[Wingtip Toys (Yaak, MT)],[Wingtip Toys (Compass Lake, FL)],[Wingtip Toys (Herlong, CA)],[Wingtip Toys (Highland Home, AL)],[Wingtip Toys (Naches, WA)],[Wingtip Toys (Baldwin City, KS)],[Wingtip Toys (Heartwell, NE)],[Wingtip Toys (Bethel Acres, OK)],[Wingtip Toys (Willow Valley, AZ)],[Wingtip Toys (Athol Springs, NY)],[Wingtip Toys (Paw Paw Lake, MI)],[Wingtip Toys (Lilbourn, MO)],[Wingtip Toys (Lost River, ID)],[Wingtip Toys (Rosa Sánchez, PR)],[Wingtip Toys (Vamo, FL)],[Wingtip Toys (Balko, OK)],[Wingtip Toys (Lime Lake, NY)],[Wingtip Toys (Teutopolis, IL)],[Wingtip Toys (Gargatha, VA)],[Wingtip Toys (Cadogan, PA)],[Wingtip Toys (Lucasville, OH)],[Wingtip Toys (Cylon, WI)],[Wingtip Toys (Asher, OK)],[Wingtip Toys (Keosauqua, IA)],[Wingtip Toys (Homer City, PA)],[Wingtip Toys (Berville, MI)],[Wingtip Toys (Tea, SD)],[Wingtip Toys (Dacono, CO)],[Wingtip Toys (Saint Landry, LA)],[Wingtip Toys (Coin, IA)],[Wingtip Toys (Salt Wells, NV)],[Wingtip Toys (Delray, WV)],[Wingtip Toys (Mount Summit, IN)],[Wingtip Toys (Smoot, WY)],[Wingtip Toys (Lake Davis, CA)],[Wingtip Toys (Stanardsville, VA)],[Wingtip Toys (Corcovado, PR)],[Wingtip Toys (Taft Heights, CA)],[Wingtip Toys (West Hempstead, NY)],[Wingtip Toys (Portales, NM)],[Wingtip Toys (Coker, AL)],[Wingtip Toys (Haydenville, OH)],[Wingtip Toys (Mayhill, NM)],[Wingtip Toys (Vair, TX)],[Wingtip Toys (Crossroads, NM)],[Wingtip Toys (Cowlington, OK)],[Wingtip Toys (Glen Ullin, ND)],[Wingtip Toys (Oologah, OK)],[Wingtip Toys (Lytle, TX)],[Wingtip Toys (Mahaffey, PA)],[Wingtip Toys (Sunburg, MN)],[Wingtip Toys (Johnetta, KY)],[Wingtip Toys (Universal City, TX)],[Wingtip Toys (Ridgemark, CA)],[Wingtip Toys (San Jacinto, CA)],[Wingtip Toys (Floriston, CA)],[Wingtip Toys (Bokeelia, FL)],[Wingtip Toys (Cale, AR)],[Wingtip Toys (Karthaus, PA)],[Wingtip Toys (Glancy, MS)],[Wingtip Toys (Stoneboro, PA)],[Wingtip Toys (Mier, IN)],[Wingtip Toys (Wapinitia, OR)],[Wingtip Toys (White Church, MO)],[Wingtip Toys (Caton, NY)],[Wingtip Toys (Plum Branch, SC)],[Wingtip Toys (Mauldin, SC)],[Wingtip Toys (Bonner Springs, KS)],[Wingtip Toys (Lowellville, OH)],[Wingtip Toys (Elverson, PA)],[Wingtip Toys (Isabela, PR)],[Wingtip Toys (Sayner, WI)],[Wingtip Toys (Beals, ME)],[Wingtip Toys (Morton Grove, IL)],[Wingtip Toys (Birds, IL)],[Wingtip Toys (Federalsburg, MD)],[Wingtip Toys (Pikeview, CO)],[Wingtip Toys (Boalsburg, PA)],[Wingtip Toys (Port Hueneme, CA)],[Wingtip Toys (Verdery, SC)],[Wingtip Toys (Obetz, OH)],[Wingtip Toys (East Fultonham, OH)],[Wingtip Toys (Obion, TN)],[Wingtip Toys (Cavendish, VT)],[Wingtip Toys (Miesville, MN)],[Wingtip Toys (Valhalla, NC)],[Wingtip Toys (Cape Neddick, ME)],[Wingtip Toys (Silver Plume, CO)],[Wingtip Toys (North Beach Haven, NJ)],[Wingtip Toys (Downingtown, PA)],[Wingtip Toys (Branson West, MO)],[Wingtip Toys (Bergen Park, CO)],[Wingtip Toys (Grabill, IN)],[Wingtip Toys (North Manitou, MI)],[Wingtip Toys (Philip, SD)],[Wingtip Toys (Straughn, IN)],[Wingtip Toys (Gilford, NH)],[Wingtip Toys (Del Valle, TX)],[Wingtip Toys (Harkers Island, NC)],[Wingtip Toys (Licking, MO)],[Wingtip Toys (Raton, NM)],[Wingtip Toys (Boynton, OK)],[Wingtip Toys (Frenchburg, KY)],[Wingtip Toys (Robertsdale, AL)],[Wingtip Toys (Dickerson, MD)],[Wingtip Toys (Bruceton Mills, WV)],[Wingtip Toys (Cloquet, MN)],[Wingtip Toys (Claycomo, MO)],[Wingtip Toys (Beekmantown, NY)],[Wingtip Toys (Islip Terrace, NY)],[Wingtip Toys (Rich Creek, VA)],[Wingtip Toys (Griswoldville, GA)],[Wingtip Toys (East Mountain, TX)],[Wingtip Toys (Omer, MI)],[Wingtip Toys (Waycross, GA)],[Wingtip Toys (Nichols Hills, OK)],[Wingtip Toys (Plaquemine, LA)],[Wingtip Toys (Triadelphia, WV)],[Wingtip Toys (Ferney, SD)],[Wingtip Toys (Akhiok, AK)],[Wingtip Toys (Deeson, MS)],[Wingtip Toys (Nuangola, PA)],[Wingtip Toys (Weld, ME)],[Wingtip Toys (Mickleton, NJ)],[Wingtip Toys (Schererville, IN)],[Wingtip Toys (Lexington Heights, MI)],[Wingtip Toys (Broomtown, AL)],[Wingtip Toys (Jamison, IA)],[Wingtip Toys (Key Biscayne, FL)],[Wingtip Toys (Chaseley, ND)],[Wingtip Toys (Indian Creek, IL)],[Wingtip Toys (Lake Ronkonkoma, NY)],[Wingtip Toys (Morrison Bluff, AR)],[Wingtip Toys (Huntingburg, IN)],[Wingtip Toys (Shay, PA)],[Wingtip Toys (Helotes, TX)],[Wingtip Toys (Hollandsburg, IN)],[Wingtip Toys (Liberty Grove, MD)],[Wingtip Toys (Morita, TX)],[Wingtip Toys (New Laguna, NM)],[Wingtip Toys (Bourneville, OH)],[Wingtip Toys (Mendoza, TX)],[Wingtip Toys (Palmas del Mar, PR)],[Wingtip Toys (Marion Junction, AL)],[Wingtip Toys (Ware Shoals, SC)],[Wingtip Toys (Lostine, OR)],[Wingtip Toys (Tilleda, WI)],[Wingtip Toys (Wapiti, WY)],[Wingtip Toys (Amado, AZ)],[Wingtip Toys (Jeromesville, OH)],[Wingtip Toys (Ovilla, TX)],[Wingtip Toys (West Frostproof, FL)],[Wingtip Toys (Flomaton, AL)],[Wingtip Toys (Pawlet, VT)],[Wingtip Toys (Trout Run, PA)],[Wingtip Toys (Marin City, CA)],[Wingtip Toys (Molalla, OR)],[Wingtip Toys (Trumansburg, NY)],[Wingtip Toys (Goodings Grove, IL)],[Wingtip Toys (Cherryplain, NY)],[Wingtip Toys (Bell Acres, PA)],[Wingtip Toys (Connoquenessing, PA)],[Wingtip Toys (Sarversville, PA)],[Wingtip Toys (Munich, ND)],[Wingtip Toys (Montoya, NM)],[Wingtip Toys (Knights Landing, CA)],[Wingtip Toys (Cache, OK)],[Wingtip Toys (Towaco, NJ)],[Wingtip Toys (Lynne, FL)],[Wingtip Toys (Plata, TX)],[Wingtip Toys (Oak Point, TX)],[Wingtip Toys (Alcester, SD)],[Wingtip Toys (McAdenville, NC)],[Wingtip Toys (Idaho City, ID)],[Wingtip Toys (Dunkerton, IA)],[Wingtip Toys (Cuyamungue, NM)],[Wingtip Toys (Marfa, TX)],[Wingtip Toys (Accomac, VA)],[Wingtip Toys (Cos Cob, CT)],[Wingtip Toys (Haycock, AK)],[Wingtip Toys (Kapa'a, HI)],[Wingtip Toys (Dickworsham, TX)],[Wingtip Toys (Caro, MI)],[Wingtip Toys (Ruthsburg, MD)],[Eric Torres],[Cosmina Vlad],[Bala Dixit],[Aleksandrs Riekstins],[Ratan Poddar],[Shi Tu],[Gunnar Lohmus],[Jackson Kolios],[Madhu Dwivedi],[Alena Kellnerova],[Surendra Sahu],[Celica Barajas],[Shyam Poddar],[Johanna Hoornstra],[Libuse Valentova],[Harsha Huq],[Agrita Kanepa],[Liia Orav],[Santiago Vera],[Knut Svensson],[Kwanjai Saowaluk],[Suparna Bhattacharya],[Francisca Laureano],[Risto Valbe],[Jayanta Thakur],[Leila Carvalho],[Crina Grasu],[Sercan Celik],[Jack Walker],[Jana Fialova],[Bhaavan Rai],[Aakriti Byrraju],[Devraj Rao],[Cong Hoa],[Dominic Davignon],[Abel Spirlea],[Anil Sarkar],[Pavel Bogdanov],[Juan Morse],[Rodrigo Figueiredo],[Camille Authier],[Biju Deb],[Marija Justina Pasek],[Durdanah Abbasi],[Emilie Hrdlickova],[Malorie Bousquet],[Kristiina Ivanov],[Alvin Bollinger],[Sabine Zalite],[Daakshaayaani Sankaramanchi],[Ebru Erdogan],[Bhagavaan Atluri],[Caterina Pinto],[Daakshaayaani Kommineni],[Anna Mazzanti],[Satish Mittal],[Clarissa Manfrin],[Bimla PrabhupÄda],[Shah Alizadeh],[Marcela Lucescu],[Amarasimha Vinjamuri],[Lana Goransson],[Jakub Lukes],[Mikhail Degtyarev],[Bijoya Thakur],[Jay Bhuiyan],[Jasna Cerkez],[Laura Sykorova],[Abel Tatarescu],[In-Su Bae],[Darshana Madhunapantula],[Katerina Hadrabova],[Hana Hlouskova],[Daniel Martensson],[Philip Walker],[Marie LeBatelier],[Leyla Siavashi],[Miriam House],[Jitka Necesana],[Edmee Glissen],[Magdalena Michnova],[Maryann Huddleston],[Radha Barua],[Anindya Ghatak],[Chandrashekhar Dasgupta],[Debbie Molina],[Baran Jonsson],[Jai Lamble],[Sointu Savonheimo],[Olya Izmaylov],[Taneli Riutta],[Bahaar Asef zade],[Leyla Asef zade],[Gabriela Hernandes],[Geza Roman],[Leonardo Folliero],[Allan Mannik],[Gopalgobinda Sikdar],[Chin-Sun Chang],[Lilli Sokk],[Adrian Andreasson],[Kamila Michnova],[Bing Han],[Olafs Rozitis],[Sara Huiting],[Ajitaab Pakalapati],[Eugen Agafitei],[Sumati Bhat],[Dena Glissen],[Elina Kaleja],[Liidia Lepp],[Volkan senturk],[Violetta KlanCisar],[Chandana Shasthri],[Ana Florea],[Pinja Jantunen],[Pari Hosseini],[Isidora Morales],[Kertu Sokk],[Gayatri Gajula],[Victoria Lacusta],[Sumati Chatterjee],[Tai Bach],[Eva Schulteisz],[Can ozcan],[Richard Friar],[Matyas Sedlar],[Arijit Bhuiyan],[Vladimir Henzl],[Shantanu Huq],[Nada Jovanovic],[Nicolo Cattaneo],[Joel Carrillo],[Ivan Sepulveda],[Daevasree Samavedam],[Ludmila Smidova],[Manca Hrastovsek],[Anna Gyarmathi],[Ioana Florea],[Lorin Astrom],[Bishwa Chatterjee],[Chaayaadaevi Sonti],[Drazenka Jelic],[Ida Celma],[Hoc Tran],[David safranek],[Svetlana Todorovic],[Richard Zahradnicek],[Seo-yun Paik],[Emily Whittle],[Eliza Persson],[Chuan Wattanasin],[Linh Dao],[Nasrin Omidzadeh],[Raghu Sandhu],[Nhung Thach],[Hee-Young Suh],[Valentin Tirlea],[Dhaatri Chavva],[Edgar Jogi],[Rani Ganguly],[Bhagavati Vinjamuri],[Be Trang],[Ingrida Zeltina],[Phoung Cu],[Sara Walkky],[Meera Patel],[Anca Gogean],[Staffan Persson],[Isidora Urias],[Dhanishta Mokkapati],[Lakshmi Benipal],[Kumar Kamei],[Emil Roman],[Prabodh Nair],[Alinne Matos],[Mauno Laurila],[Baalaamjali Devulapalli],[Melani Ravlen],[Om Yadav],[Mahmut ozbek],[Yves Belisle],[Sabine Alksne],[Kamala Nishad],[Roko Ilic],[Neil Farrelly],[Akhil Nadar],[Maksims Krastins],[Milinka Zujovic],[Andris Saulitis],[Valter Viiding],[Amarakumaar Gadiyaram],[Gasper Havzija],[Libuse Kuchtova],[Kumar Naicker],[Laszlo Gardenier],[Nada Ana Slosar],[Mahavir Sonkar],[Kristi Part],[Krishnam Allu],[Dinh Mai],[Stefan Selezeanu],[Hue Ton],[Drishti Bose],[Bhadram Kamasamudram],[Taj Syme],[Irma Berzina],[Vedrana Kovacevic],[Bhagavateeprasaad Malladi],[Serdar ozCelik],[Rajeev Sandhu],[Urve Kasesalu],[Annette  Hetu],[Narendra Tickoo],[Isa Hulsegge],[Aive Petrov],[David Novacek ],[Nils Kaulins],[Dhanishta Pullela],[Hai Banh],[Fabrice Cloutier],[Nadir Seddigh],[Farzana Habibi],[Arka Chatterjee],[Tuulikki Linna],[Daniella Cavalcante],[Serdar ozden],[Emma Van Zant],[Veronika Necesana],[Chompoo Atitarn],[Dipti Shah],[Som Mukherjee],[Cuneyt Arslan],[Aishwarya Dantuluri],[Manjunatha Karnik],[Erik Malk],[David Jaramillo],[Damodara Trivedi],[Bhaamini Palagummi],[Damodar Shenoy],[Tomo Vidovic],[Nguyen Banh],[Raj Verma],[Hanita Nookala],[Matteo Cattaneo],[Christian Couet],[Ivana Hadrabova],[Abhra Ganguly],[Amet Shergill],[Amrita Ganguly],[Sylvie Laramee],[Ian Olofsson],[Luis Saucedo],[Emma Salpa],[Adriana Pena],[Kalyani Benjaree],[Ganesh Majumdar],[Jaroslav Fisar],[Jibek Juniskyzy],[Anand Mudaliyar],[Agrita Abele],[Aleksey - Updated],[Andrey - Updated],[Anton MERGE],[Argronom MERGE],[Aleksey - UpdatedNEW RECORD],[Andrey - UpdatedNEW RECORD]
) ) as PivotTable 
order by PivotTable.InvDate


  
/*Почему строчки не эквивалентны. 1- работает, 2- пустой результат, 3 - падает*/
SELECT * FROM [Sales].[Customers] WHERE [CustomerName] in ('Tailspin Toys (Head Office)','Tailspin Toys (Frankewing, TN)')

EXEC 'SELECT * FROM [Sales].[Customers] WHERE [CustomerName] in ( ''Tailspin Toys (Head Office)'',''Tailspin Toys (Frankewing, TN)'' )'

EXECUTE sp_executesql N'SELECT * FROM [Sales].[Customers] WHERE [CustomerName] in (@list)',
          N'@list nvarchar(max)',  
          @list =' ''Tailspin Toys (Head Office)'',''Tailspin Toys (Frankewing, TN)'' ';  


